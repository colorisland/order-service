# order-service
- - - 
## History
| Date       |Author| Description |
|:-----------|:---|:------------|
| 2025-06-09 |ê¹€ì±„ì›| ì£¼ë¬¸ ì„œë¹„ìŠ¤ API  | 

## Getting Started
### System Requirements
|Name|Version| Description                                                                             |
|---|:---:|:----------------------------------------------------------------------------------------|
|OpenJDK|17.0.6| í˜„ì¬ ì‹¤ë¬´ì—ì„œ ì‚¬ìš©ì¤‘ì¸ ë²„ì „                                              |
|Springboot|3.5.0| SNAPSHOT ì´ ì•„ë‹Œ ë²„ì „ ì¤‘ ê°€ì¥ ìµœì‹ ë²„ì „|

### How To Run
+ í”„ë¡œì íŠ¸ ì‹¤í–‰
  + http://localhost:8080/swagger-ui/index.html# ì ‘ì†
+ H2 DB ì½˜ì†”
  + http://localhost:8080/h2-console ì ‘ì†
  + JDBC URL : jdbc:h2:mem:testdb ì…ë ¥
  + User Name: sa ì…ë ¥
  + Password: ì—†ìŒ


## Development
### Overall Process
```
ìš”êµ¬ì‚¬í•­ ì •ë¦¬ -> DB ì„¤ê³„ -> í”„ë¡œì íŠ¸ êµ¬ì¡° ì •ì˜ -> êµ¬í˜„ & í…ŒìŠ¤íŠ¸ -> ë¦¬íŒ©í† ë§ 
```
### Dependencies
+ spring-boot-starter-web
    + ìŠ¤í”„ë§ë¶€íŠ¸ì˜ ì½”ì–´
    + ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ ê¸°ë³¸ ì˜ì¡´ì„± ì œê³µ
+ spring-boot-starter-validation
  + Request DTO ìœ íš¨ì„± ê²€ì‚¬
+ spring-boot-starter-data-jpa
  + JPA(Hibernate)ë¥¼ ì‚¬ìš©í•˜ì—¬ ORM, Repository êµ¬í˜„
+ springdoc-openapi-starter-webmvc
  + Swagger UI, ë¬¸ì„œí™” ê¸°ëŠ¥ ì œê³µ
+ lombok
  + ì• ë…¸í…Œì´ì…˜ ê¸°ë°˜ ìƒì„±ì, Builder, ìœ íš¨ì„± ê²€ì‚¬ ì œê³µ
+ h2database
  + ì¸ë©”ëª¨ë¦¬ ê¸°ë°˜ H2 DB
+ spring-boot-starter-test
  + í…ŒìŠ¤íŠ¸ ì§€ì›
## Architecture
### ê³„ì¸µ êµ¬ì¡°
ì‹¤ë¬´ì—ì„œëŠ” ë¹„ì¦ˆë‹ˆìŠ¤(ì£¼ë¬¸,íšŒì›,ìƒí’ˆ) ì¤‘ì‹¬ìœ¼ë¡œ íŒ¨í‚¤ì§€ë¥¼ ìƒì„±í•˜ê³  í•˜ìœ„ì— controller, service, dto ë¥¼ ìœ„ì¹˜ì‹œí‚¤ì§€ë§Œ ê³¼ì œì—ì„œëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ì¢…ë¥˜ê°€ ë§ì§€ ì•Šê¸° ë•Œë¬¸ì— ê³„ì¸µ ì¤‘ì‹¬ìœ¼ë¡œ êµ¬ì¡°ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.
```
com.assignment.order_service
â”œâ”€â”€ controller                # ğŸ‘‰ API ì»¨íŠ¸ë¡¤ëŸ¬
â”‚   â””â”€â”€ OrderController.java
â”‚
â”œâ”€â”€ service                   # ğŸ‘‰ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¸í„°í˜ì´ìŠ¤
â”‚   â”œâ”€â”€ OrderService.java
â”‚   â””â”€â”€ Impl                  # ğŸ‘‰ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„
â”‚
â”œâ”€â”€ dto                       # ğŸ‘‰ ìš”ì²­/ì‘ë‹µ ê°ì²´
â”‚
â”œâ”€â”€ enums                     # ğŸ‘‰ enum
â”‚
â”œâ”€â”€ domain                    # ğŸ‘‰ JPA Entity + Repository
â”‚
â”œâ”€â”€ exception                 # ğŸ‘‰ ì˜ˆì™¸ ì²˜ë¦¬
â”‚
â””â”€â”€ OrderServiceApplication.java

```
### ë„¤ì´ë° ê·œì¹™
+ ì„œë¹„ìŠ¤ ë©”ì„œë“œ ì´ë¦„ ê·œì¹™: ì¹´ë©œì¼€ì´ìŠ¤ ì‚¬ìš©, ë™ì‚¬í˜•ìœ¼ë¡œ ì´ë¦„ ì§“ê¸°
+ í…ŒìŠ¤íŠ¸ ë©”ì„œë“œ ì´ë¦„ ê·œì¹™: ìŠ¤ë„¤ì´í¬ì¼€ì´ìŠ¤ ì‚¬ìš©, ê¸°ëŠ¥_ê²°ê³¼ í˜•ì‹ìœ¼ë¡œ ì´ë¦„ ì§“ê¸°
+ DTO í´ë˜ìŠ¤ ì´ë¦„ ê·œì¹™: Request, Response ì ‘ë¯¸ì‚¬ ë¶™ì—¬ì„œ êµ¬ë¶„.

### ê³µí†µ ì‘ë‹µ ì²˜ë¦¬ ë° ì˜ˆì™¸ ì²˜ë¦¬
í´ë¼ì´ì–¸íŠ¸ì—ì„œ HTTP Status Code ë§Œìœ¼ë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” ë° í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤.
ê·¸ë˜ì„œ í´ë¼ì´ì–¸íŠ¸ê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ì„±ê³µ/ì‹¤íŒ¨ ì‘ë‹µì„ ì¼ê´€ë˜ê²Œ ë°›ì„ ìˆ˜ ìˆë„ë¡ BusinessResponse êµ¬ì¡°ë¥¼ ì •ì˜í–ˆìŠµë‹ˆë‹¤.
ì˜ˆì™¸ ì²˜ë¦¬ ì‹œ @RestControllerAdvice ì—ì„œ ë°›ì•„ì„œ BusinessResponse í˜•íƒœë¡œ ë¦¬í„´í•©ë‹ˆë‹¤.
ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œëŠ” Enum ìœ¼ë¡œ ê´€ë¦¬ë˜ë©° 
ì„±ê³µ/ì‹¤íŒ¨ ì‘ë‹µ ëª¨ë‘ ì•„ë˜ì™€ ê°™ì€ body ë¡œ ì‘ë‹µë©ë‹ˆë‹¤.
```
{
  "data": {
    "resultCode": "SUCCESS_CODE or ERROR_CODE",
    "resultMessage": "ì‘ë‹µ ë©”ì‹œì§€",
    "resultData": { ... }
  }
}
```
### ERD & ë„ë©”ì¸ ì„¤ê³„
![ERD.png](ERD.png)
ì£¼ë¬¸ ê´€ë ¨ í…Œì´ë¸”ì€ DELETE ì—°ì‚°ì„ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.
1. product

   ìƒí’ˆ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” í…Œì´ë¸”.

   ì¬ê³  ì°¨ê°ê³¼ í• ì¸ ì ìš©ì„ ìœ„í•œ discount_amount, stock_quantity í•„ë“œ ì¡´ì¬.

2. orders

   ì‚¬ìš©ìì˜ ë‹¨ì¼ ì£¼ë¬¸ê±´ì„ ê´€ë¦¬í•˜ëŠ” í…Œì´ë¸”.

   1ê°œì˜ ë‹¨ì¼ ì£¼ë¬¸ì´ ì—¬ëŸ¬ ìƒí’ˆì„ í¬í•¨í•  ìˆ˜ ìˆì–´ì„œ order_item ê³¼ 1:N ê´€ê³„ë¥¼ ê°€ì§„ë‹¤.
3. order_item

   ë‹¨ì¼ ì£¼ë¬¸ì—ì„œ ì–´ë–¤ ìƒí’ˆì„ ëª‡ ê°œ ì£¼ë¬¸í–ˆëŠ”ì§€ ê´€ë¦¬í•˜ëŠ” í…Œì´ë¸”.

   is_cancelled ì»¬ëŸ¼ì„ í†µí•´ ìƒí’ˆ ë‹¨ìœ„ì˜ ì·¨ì†Œ ì—¬ë¶€ë¥¼ ê´€ë¦¬í•œë‹¤.

   ê´€ë¦¬ìì— ì˜í•´ ìƒí’ˆ ì •ë³´ê°€ ë³€ë™ë  ìˆ˜ ìˆìœ¼ë‹ˆ discounted_price ì™€ total_price ë¥¼ ë³„ë„ë¡œ ì €ì¥í•œë‹¤.

## API
### ì£¼ë¬¸ ìƒì„± API
```mermaid
graph TD; 
B[ìƒí’ˆ IDë¡œ Product ì¡°íšŒ]
B --> A{ìœ íš¨í•œ ìƒí’ˆ ì•„ì´ë””?}
A -- No --> C[PRODUCT_NOT_FOUND ì˜ˆì™¸]
A -- Yes --> E{ì¬ê³  ìˆ˜ëŸ‰ â‰¥ ìš”ì²­ ìˆ˜ëŸ‰ ì¸ì§€ í™•ì¸}
E -- No --> F[INSUFFICIENT_STOCK ì˜ˆì™¸]
E -- Yes --> G[ì¬ê³  ì°¨ê°]
G --> H[í• ì¸ ê¸ˆì•¡ ê³„ì‚°]
H --> K[ì£¼ë¬¸ìƒì„± ì„±ê³µ]
```
### ì£¼ë¬¸ ìƒí’ˆ ê°œë³„ ì·¨ì†Œ API
```mermaid
graph TD
D[ì£¼ë¬¸ IDë¡œ Order ì¡°íšŒ]
D --> E{ì£¼ë¬¸ì— í•´ë‹¹ ìƒí’ˆì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸}
E -- No --> F[PRODUCT_NOT_FOUND ì˜ˆì™¸]
E -- Yes --> G{ì´ë¯¸ ì·¨ì†Œëœ ìƒí’ˆì¸ì§€ í™•ì¸}
G -- Yes --> H[ALREADY_CANCELLED ì˜ˆì™¸]
G -- No --> I[isCancelled = true ì„¤ì •]
I --> J[ìƒí’ˆ ì¬ê³  ë³µêµ¬]
J --> K[í™˜ë¶ˆ ê¸ˆì•¡ ê³„ì‚°]
K --> L[ë‚¨ì€ ì£¼ë¬¸ ê¸ˆì•¡ ê³„ì‚°]
L --> M[ê°œë³„ ì·¨ì†Œ ì„±ê³µ]
```
### ì£¼ë¬¸ ìƒí’ˆ ì¡°íšŒ API
```mermaid
graph TD;
D[ì£¼ë¬¸ IDë¡œ Order ì¡°íšŒ]
D --> A{ì£¼ë¬¸ ì¡´ì¬ ì—¬ë¶€ í™•ì¸}
A -- No --> B[ORDER_NOT_FOUND ì˜ˆì™¸]
A -- Yes --> E[ì£¼ë¬¸ì— í¬í•¨ëœ ì£¼ë¬¸ í•­ëª© ëª©ë¡ ìˆœíšŒ]
E --> F[ItemDetail DTOë¡œ ë§¤í•‘]
F --> G[ì·¨ì†Œë˜ì§€ ì•Šì€ í•­ëª©ë§Œ ê³¨ë¼ ì´ ê¸ˆì•¡ ê³„ì‚°]
G --> H[ì£¼ë¬¸ ìƒí’ˆ ì¡°íšŒ ì„±ê³µ]
```
## Testing Strategy 
í”„ë ˆì„ì›Œí¬ë¡œ JUnit5 ì‚¬ìš©í–ˆìœ¼ë©° ê°€ë…ì„±ì´ ì¢‹ì€ AssertJ (Assertions.assertThat) ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

